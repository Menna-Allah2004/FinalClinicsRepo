@model List<MedicalConnect.ViewModels.ContactUsMessageViewModel>
@{
    ViewData["Title"] = "رسائل التواصل";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-page-container">
    <div class="page-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="page-title">
                    <i class="fas fa-envelope text-info me-2"></i>
                    رسائل التواصل
                </h2>
                <p class="text-muted">إدارة ومتابعة رسائل المستخدمين</p>
            </div>
            <div class="col-md-4 text-end">
                <span class="badge bg-danger fs-6">
                    @Model.Count(m => !m.IsRead) غير مقروءة
                </span>
            </div>
        </div>
    </div>

    <!-- Filter Tabs -->
    <div class="message-filters mb-4">
        <ul class="nav nav-pills">
            <li class="nav-item">
                <a class="nav-link active" href="#" data-filter="all">
                    <i class="fas fa-inbox me-1"></i>
                    جميع الرسائل (@Model.Count)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-filter="unread">
                    <i class="fas fa-circle me-1"></i>
                    غير مقروءة (@Model.Count(m => !m.IsRead))
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-filter="read">
                    <i class="fas fa-check-circle me-1"></i>
                    مقروءة (@Model.Count(m => m.IsRead))
                </a>
            </li>
        </ul>
    </div>

    @if (Model.Any())
    {
        <div class="messages-container">
            @foreach (var message in Model)
            {
                <div class="message-card @(!message.IsRead ? "unread" : "")" data-status="@(message.IsRead ? "read" : "unread")">
                    <div class="message-header">
                        <div class="sender-info">
                            <div class="sender-avatar">
                                <i class="fas fa-user-circle fa-2x text-secondary"></i>
                            </div>
                            <div class="sender-details">
                                <h6 class="sender-name">@message.Name</h6>
                                <span class="sender-email">@message.Email</span>
                            </div>
                        </div>
                        <div class="message-meta">
                            <span class="message-date">@message.CreatedAt</span>
                            @if (!message.IsRead)
                            {
                                <span class="unread-indicator">
                                    <i class="fas fa-circle text-primary"></i>
                                </span>
                            }
                        </div>
                    </div>

                    <div class="message-subject">
                        <h5>@message.Subject</h5>
                    </div>

                    <div class="message-preview">
                        <p>@message.Message</p>
                    </div>

                    <div class="message-actions">
                        <a href="@Url.Action("MessageDetails", "Admin", new { id = message.Id })"
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-eye me-1"></i>
                            عرض التفاصيل
                        </a>
                        <form asp-action="Delete" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@message.Id" />
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('هل أنت متأكد من حذف هذه الرسالة؟')">
                                <i class="fas fa-trash me-1"></i>
                                حذف
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="text-center py-5">
                <i class="fas fa-inbox text-muted fa-5x mb-4"></i>
                <h3 class="text-muted">لا توجد رسائل</h3>
                <p class="text-muted">لم يتم استلام أي رسائل من المستخدمين بعد</p>
            </div>
        </div>
    }
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterLinks = document.querySelectorAll('[data-filter]');
        const messageCards = document.querySelectorAll('.message-card');

        filterLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // Update active filter
                filterLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // Show/hide messages based on filter
                messageCards.forEach(card => {
                    if (filter === 'all') {
                        card.style.display = 'block';
                    } else {
                        const cardStatus = card.dataset.status;
                        card.style.display = cardStatus === filter ? 'block' : 'none';
                    }
                });
            });
        });
    });
</script>
